{% load bootstrap4 static %}
<script src="{% static 'js/disableOnSubmit.js' %}"></script>

<div class="modal-dialog modal-confirmation">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title mx-auto">
                <div class="fs29 text-bold-family text-{% if form_class_color %}{{ form_class_color }}{% else %}primary{% endif %}">
                    {{ title }}
                </div>
                {% if subtitle %}
                    <p>
                        <small class="subtitle">{{ subtitle }}</small>
                    </p>
                {% endif %}
            </div>
            <button type="button" class="border-0 bg-transparent close-modal" data-dismiss="modal" aria-label="Close">
                <div class="circle-icon bg-{% if form_class_color %}{{ form_class_color }}{% else %}primary{% endif %}">
                    <div class="center-27">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </button>
        </div>
        <form id="{{ id_form }}" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-body">
                <div class="overlay-wrapper">
                    {% if picture %}
                        <div class="text-center">
                            <img id="modal_form_picture" src="{{ picture }}" class="{{ picture_class }}">
                        </div>
                    {% endif %}
                    {% bootstrap_form form %}
                    <div class="overlay submit-spin">
                        <i class="fas fa-2x fa-sync-alt fa-spin"></i>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="submit" class="btn btn-lg btn-{% if form_class_color %}{{ form_class_color }}{% else %}primary{% endif %} padding-inline-60 text-right">
                    {{ submit_button }}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function(){
        let issue_password_file = $('#id_issue_password_file');
        let issue_password_file_parent = issue_password_file.parent();
        let issue_password = $('#id_issue_password');
        let issue_password_parent = issue_password.parent();


        var password_fields = [issue_password_file, issue_password]
        var password_fields_parent = [issue_password_file_parent, issue_password_parent]
        
        password_fields.forEach(function(elt){
            if(elt){
                let form_id = elt.parent().parent().parent().parent().attr('id');
                
                if(form_id == 'issue_publish_form'){
                    elt.attr('required', true);
                }else{
                    {% if not doc.category %}
                        elt.attr('required', false);
                    {% elif doc.category.id == 4 or doc.category.id == 7 %}
                        elt.attr('required', true);
                    {% else %}
                        elt.attr('required', false);
                    {% endif %}
                }
            }
        });
        password_fields_parent.forEach(function(elt){
            if(elt){
                let form_id = elt.parent().parent().parent().attr('id');
                
                if(form_id == 'issue_publish_form'){
                    elt.show();
                }else{
                    {% if not doc.category %}
                        elt.show();
                    {% elif doc.category.id == 4 or doc.category.id == 7 %}
                        elt.show();
                    {% else %}
                        elt.hide();
                    {% endif %}
                }
            }
        });


        $('#id_file_pdf').attr(
            "accept", 
            ".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
        );

    });
</script>